<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProForex Journal</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: { 900: '#0a0e1a', 800: '#0f1629', 700: '#151d35', 600: '#1a2642' },
            gold: { 500: '#d4af37', 400: '#e6c65c', 300: '#f0d98a' },
            profit: '#10b981',
            loss: '#ef4444'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace']
          }
        }
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    
    .glass-card {
      background: linear-gradient(135deg, rgba(15, 22, 41, 0.9) 0%, rgba(21, 29, 53, 0.8) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(212, 175, 55, 0.1);
    }
    
    .glass-card:hover {
      border-color: rgba(212, 175, 55, 0.2);
    }
    
    .gold-glow {
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.1);
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    .animate-slide-up {
      animation: slideUp 0.6s ease-out forwards;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #d4af37;
      box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
    }
    
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #0a0e1a; }
    ::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 3px; }
    
    .btn-gold {
      background: linear-gradient(135deg, #d4af37 0%, #b8962e 100%);
      transition: all 0.3s ease;
    }
    
    .btn-gold:hover {
      background: linear-gradient(135deg, #e6c65c 0%, #d4af37 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
    }
    
    .metric-card {
      position: relative;
      overflow: hidden;
    }
    
    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #d4af37, transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .metric-card:hover::before {
      opacity: 1;
    }
    
    .nav-item {
      position: relative;
      transition: all 0.3s ease;
    }
    
    .nav-item::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      width: 0;
      height: 2px;
      background: #d4af37;
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }
    
    .nav-item:hover::after, .nav-item.active::after {
      width: 100%;
    }
    
    .table-row {
      transition: all 0.2s ease;
    }
    
    .table-row:hover {
      background: rgba(212, 175, 55, 0.05);
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full bg-navy-900 text-gray-100 font-sans overflow-auto">
  <div id="app" class="min-h-full w-full"><!-- Auth Screen -->
   <div id="auth-screen" class="min-h-full w-full flex items-center justify-center p-4" style="background: radial-gradient(ellipse at top, #151d35 0%, #0a0e1a 100%);">
    <div class="w-full max-w-md"><!-- Logo -->
     <div class="text-center mb-8 animate-fade-in">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-gold-500 to-gold-400 mb-4 gold-glow">
       <svg class="w-8 h-8 text-navy-900" fill="currentColor" viewbox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" />
       </svg>
      </div>
      <h1 id="auth-title" class="text-3xl font-bold text-white mb-2">ProForex Journal</h1>
      <p id="auth-tagline" class="text-gray-400">Professional Trading Journal</p>
     </div><!-- Auth Card -->
     <div class="glass-card rounded-2xl p-8 animate-slide-up"><!-- Login Form -->
      <div id="login-form">
       <h2 class="text-xl font-semibold text-white mb-6">Welcome Back</h2>
       <form id="login-submit" class="space-y-4">
        <div><label class="block text-sm text-gray-400 mb-2">Email Address</label> <input type="email" id="login-email" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white placeholder-gray-500" placeholder="trader@example.com">
        </div>
        <div><label class="block text-sm text-gray-400 mb-2">Password</label> <input type="password" id="login-password" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white placeholder-gray-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div><button type="submit" class="w-full py-3 btn-gold rounded-xl text-navy-900 font-semibold"> Sign In </button>
       </form>
       <div class="mt-6 text-center space-y-2"><button id="show-forgot" class="text-gold-500 hover:text-gold-400 text-sm">Forgot Password?</button>
        <p class="text-gray-500 text-sm">Don't have an account? <button id="show-signup" class="text-gold-500 hover:text-gold-400">Sign Up</button></p>
       </div>
      </div><!-- Signup Form -->
      <div id="signup-form" class="hidden">
       <h2 class="text-xl font-semibold text-white mb-6">Create Account</h2>
       <form id="signup-submit" class="space-y-4">
        <div><label class="block text-sm text-gray-400 mb-2">Full Name</label> <input type="text" id="signup-name" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white placeholder-gray-500" placeholder="John Trader">
        </div>
        <div><label class="block text-sm text-gray-400 mb-2">Email Address</label> <input type="email" id="signup-email" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white placeholder-gray-500" placeholder="trader@example.com">
        </div>
        <div><label class="block text-sm text-gray-400 mb-2">Password</label> <input type="password" id="signup-password" required minlength="6" class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white placeholder-gray-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div><button type="submit" class="w-full py-3 btn-gold rounded-xl text-navy-900 font-semibold"> Create Account </button>
       </form>
       <p class="mt-6 text-center text-gray-500 text-sm">Already have an account? <button id="show-login" class="text-gold-500 hover:text-gold-400">Sign In</button></p>
      </div><!-- Forgot Password Form -->
      <div id="forgot-form" class="hidden">
       <h2 class="text-xl font-semibold text-white mb-6">Reset Password</h2>
       <form id="forgot-submit" class="space-y-4">
        <div><label class="block text-sm text-gray-400 mb-2">Email Address</label> <input type="email" id="forgot-email" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white placeholder-gray-500" placeholder="trader@example.com">
        </div><button type="submit" class="w-full py-3 btn-gold rounded-xl text-navy-900 font-semibold"> Send Reset Link </button>
       </form>
       <p class="mt-6 text-center text-gray-500 text-sm">Remember your password? <button id="show-login-2" class="text-gold-500 hover:text-gold-400">Sign In</button></p>
      </div>
     </div><!-- Demo Notice -->
     <p class="text-center text-gray-600 text-xs mt-6 animate-fade-in">Demo: Use any email/password to sign in</p>
    </div>
   </div><!-- Dashboard -->
   <div id="dashboard" class="hidden min-h-full w-full"><!-- Header -->
    <header class="sticky top-0 z-50 glass-card border-b border-navy-700">
     <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
       <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-gold-500 to-gold-400 flex items-center justify-center">
         <svg class="w-5 h-5 text-navy-900" fill="currentColor" viewbox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" />
         </svg>
        </div><span id="dashboard-title" class="text-xl font-bold text-white hidden sm:block">ProForex Journal</span>
       </div><!-- Navigation -->
       <nav class="hidden md:flex items-center gap-8"><button class="nav-item active text-white font-medium" data-view="overview">Overview</button> <button class="nav-item text-gray-400 hover:text-white" data-view="journal">Journal</button> <button class="nav-item text-gray-400 hover:text-white" data-view="analytics">Analytics</button> <button class="nav-item text-gray-400 hover:text-white" data-view="history">History</button>
       </nav><!-- User Menu -->
       <div class="flex items-center gap-4"><button id="add-trade-btn" class="btn-gold px-4 py-2 rounded-lg text-navy-900 font-medium text-sm flex items-center gap-2">
         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
         </svg><span class="hidden sm:inline">Add Trade</span> </button>
        <div class="relative"><button id="user-menu-btn" class="flex items-center gap-2 text-gray-400 hover:text-white">
          <div class="w-8 h-8 rounded-full bg-navy-700 flex items-center justify-center"><span id="user-initial" class="text-sm font-medium">T</span>
          </div>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg></button>
         <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 glass-card rounded-xl py-2 shadow-xl">
          <div class="px-4 py-2 border-b border-navy-700">
           <p id="user-name-display" class="text-white font-medium text-sm">Trader</p>
           <p id="user-email-display" class="text-gray-500 text-xs">trader@example.com</p>
          </div><button id="export-csv" class="w-full px-4 py-2 text-left text-gray-400 hover:text-white hover:bg-navy-800 text-sm flex items-center gap-2">
           <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
           </svg> Export CSV </button> <button id="logout-btn" class="w-full px-4 py-2 text-left text-red-400 hover:text-red-300 hover:bg-navy-800 text-sm flex items-center gap-2">
           <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
           </svg> Sign Out </button>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Mobile Nav -->
     <div class="md:hidden border-t border-navy-700 px-4 py-2 flex justify-around"><button class="nav-item active text-white text-sm py-2" data-view="overview">Overview</button> <button class="nav-item text-gray-400 text-sm py-2" data-view="journal">Journal</button> <button class="nav-item text-gray-400 text-sm py-2" data-view="analytics">Analytics</button> <button class="nav-item text-gray-400 text-sm py-2" data-view="history">History</button>
     </div>
    </header><!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"><!-- Overview View -->
     <div id="view-overview" class="space-y-6"><!-- P/L Summary Cards -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
       <div class="glass-card metric-card rounded-xl p-4 animate-slide-up stagger-1">
        <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">Today's P/L</p>
        <p id="pl-daily" class="text-2xl font-bold font-mono text-white">$0.00</p>
        <p id="pl-daily-trades" class="text-xs text-gray-500 mt-1">0 trades</p>
       </div>
       <div class="glass-card metric-card rounded-xl p-4 animate-slide-up stagger-2">
        <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">Weekly P/L</p>
        <p id="pl-weekly" class="text-2xl font-bold font-mono text-white">$0.00</p>
        <p id="pl-weekly-trades" class="text-xs text-gray-500 mt-1">0 trades</p>
       </div>
       <div class="glass-card metric-card rounded-xl p-4 animate-slide-up stagger-3">
        <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">Monthly P/L</p>
        <p id="pl-monthly" class="text-2xl font-bold font-mono text-white">$0.00</p>
        <p id="pl-monthly-trades" class="text-xs text-gray-500 mt-1">0 trades</p>
       </div>
       <div class="glass-card metric-card rounded-xl p-4 animate-slide-up stagger-4">
        <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">Total P/L</p>
        <p id="pl-total" class="text-2xl font-bold font-mono text-white">$0.00</p>
        <p id="pl-total-trades" class="text-xs text-gray-500 mt-1">0 trades</p>
       </div>
      </div><!-- Metrics Grid -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
       <div class="glass-card rounded-xl p-4 text-center">
        <div class="w-10 h-10 mx-auto mb-2 rounded-lg bg-profit/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-profit" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
        </div>
        <p id="win-rate" class="text-xl font-bold text-white font-mono">0%</p>
        <p class="text-xs text-gray-500">Win Rate</p>
       </div>
       <div class="glass-card rounded-xl p-4 text-center">
        <div class="w-10 h-10 mx-auto mb-2 rounded-lg bg-gold-500/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-gold-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
         </svg>
        </div>
        <p id="avg-rr" class="text-xl font-bold text-white font-mono">0:0</p>
        <p class="text-xs text-gray-500">Avg R:R</p>
       </div>
       <div class="glass-card rounded-xl p-4 text-center">
        <div class="w-10 h-10 mx-auto mb-2 rounded-lg bg-loss/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-loss" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
         </svg>
        </div>
        <p id="max-drawdown" class="text-xl font-bold text-white font-mono">0%</p>
        <p class="text-xs text-gray-500">Max Drawdown</p>
       </div>
       <div class="glass-card rounded-xl p-4 text-center">
        <div class="w-10 h-10 mx-auto mb-2 rounded-lg bg-blue-500/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
         </svg>
        </div>
        <p id="total-trades" class="text-xl font-bold text-white font-mono">0</p>
        <p class="text-xs text-gray-500">Total Trades</p>
       </div>
       <div class="glass-card rounded-xl p-4 text-center">
        <div class="w-10 h-10 mx-auto mb-2 rounded-lg bg-purple-500/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
        </div>
        <p id="avg-risk" class="text-xl font-bold text-white font-mono">0%</p>
        <p class="text-xs text-gray-500">Avg Risk/Trade</p>
       </div>
       <div class="glass-card rounded-xl p-4 text-center">
        <div class="w-10 h-10 mx-auto mb-2 rounded-lg bg-cyan-500/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
         </svg>
        </div>
        <p id="avg-r-multiple" class="text-xl font-bold text-white font-mono">0R</p>
        <p class="text-xs text-gray-500">Avg R-Multiple</p>
       </div>
      </div><!-- Charts Row -->
      <div class="grid lg:grid-cols-2 gap-6"><!-- Equity Curve -->
       <div class="glass-card rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Equity Curve</h3>
        <div class="h-64">
         <canvas id="equity-chart"></canvas>
        </div>
       </div><!-- Win/Loss Distribution -->
       <div class="glass-card rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Win/Loss Distribution</h3>
        <div class="h-64 flex items-center justify-center">
         <canvas id="winloss-chart"></canvas>
        </div>
       </div>
      </div><!-- Recent Trades -->
      <div class="glass-card rounded-xl p-6">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white">Recent Trades</h3><button class="text-gold-500 hover:text-gold-400 text-sm" data-view="history">View All â†’</button>
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="text-left text-gray-500 text-xs uppercase tracking-wider border-b border-navy-700">
           <th class="pb-3 pr-4">Date</th>
           <th class="pb-3 pr-4">Pair</th>
           <th class="pb-3 pr-4">Type</th>
           <th class="pb-3 pr-4">Entry</th>
           <th class="pb-3 pr-4">Result</th>
           <th class="pb-3 pr-4 text-right">P/L</th>
          </tr>
         </thead>
         <tbody id="recent-trades" class="text-sm">
          <tr class="text-gray-500">
           <td colspan="6" class="py-8 text-center">No trades yet. Add your first trade to get started!</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div><!-- Journal View -->
     <div id="view-journal" class="hidden">
      <div class="glass-card rounded-xl p-6 max-w-3xl mx-auto">
       <h2 class="text-2xl font-bold text-white mb-6">Add New Trade</h2>
       <form id="trade-form" class="space-y-6"><!-- Basic Info -->
        <div class="grid md:grid-cols-3 gap-4">
         <div><label class="block text-sm text-gray-400 mb-2">Date *</label> <input type="date" id="trade-date" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Forex Pair *</label> <select id="trade-pair" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white"> <option value="">Select Pair</option> <option value="EURUSD">EUR/USD</option> <option value="GBPUSD">GBP/USD</option> <option value="USDJPY">USD/JPY</option> <option value="XAUUSD">XAU/USD (Gold)</option> <option value="AUDUSD">AUD/USD</option> <option value="USDCAD">USD/CAD</option> <option value="USDCHF">USD/CHF</option> <option value="NZDUSD">NZD/USD</option> <option value="EURJPY">EUR/JPY</option> <option value="GBPJPY">GBP/JPY</option> <option value="EURGBP">EUR/GBP</option> <option value="BTCUSD">BTC/USD</option> <option value="US30">US30</option> <option value="NAS100">NAS100</option> </select>
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Trade Type *</label> <select id="trade-type" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white"> <option value="">Select Type</option> <option value="BUY">Buy (Long)</option> <option value="SELL">Sell (Short)</option> </select>
         </div>
        </div><!-- Price Info -->
        <div class="grid md:grid-cols-4 gap-4">
         <div><label class="block text-sm text-gray-400 mb-2">Entry Price *</label> <input type="number" step="0.00001" id="trade-entry" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white font-mono" placeholder="1.08500">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Stop Loss *</label> <input type="number" step="0.00001" id="trade-sl" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white font-mono" placeholder="1.08300">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Take Profit *</label> <input type="number" step="0.00001" id="trade-tp" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white font-mono" placeholder="1.08900">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Lot Size *</label> <input type="number" step="0.01" id="trade-lots" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white font-mono" placeholder="0.10">
         </div>
        </div><!-- Risk & Result -->
        <div class="grid md:grid-cols-3 gap-4">
         <div><label class="block text-sm text-gray-400 mb-2">Risk % *</label> <input type="number" step="0.1" id="trade-risk" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white font-mono" placeholder="1.0">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Result *</label> <select id="trade-result" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white"> <option value="">Select Result</option> <option value="WIN">Win âœ“</option> <option value="LOSS">Loss âœ—</option> <option value="BREAKEVEN">Break-even â†’</option> </select>
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Profit/Loss ($) *</label> <input type="number" step="0.01" id="trade-pnl" required class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white font-mono" placeholder="150.00">
         </div>
        </div><!-- Calculated RR -->
        <div class="glass-card rounded-xl p-4 bg-navy-800/50">
         <div class="flex items-center justify-between"><span class="text-gray-400">Calculated Risk:Reward Ratio</span> <span id="calculated-rr" class="text-xl font-bold text-gold-500 font-mono">-</span>
         </div>
        </div><!-- Notes Section -->
        <div class="space-y-4">
         <h3 class="text-lg font-semibold text-white">Trade Notes</h3>
         <div class="grid md:grid-cols-2 gap-4">
          <div><label class="block text-sm text-gray-400 mb-2">Emotion</label> <select id="trade-emotion" class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white"> <option value="">Select Emotion</option> <option value="CONFIDENT">ðŸ˜Ž Confident</option> <option value="CALM">ðŸ˜Œ Calm</option> <option value="ANXIOUS">ðŸ˜° Anxious</option> <option value="GREEDY">ðŸ¤‘ Greedy</option> <option value="FEARFUL">ðŸ˜¨ Fearful</option> <option value="FOMO">ðŸ˜¤ FOMO</option> <option value="REVENGE">ðŸ˜¡ Revenge Trading</option> </select>
          </div>
          <div><label class="block text-sm text-gray-400 mb-2">Setup Type</label> <input type="text" id="trade-setup" class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white" placeholder="e.g., Break &amp; Retest, Support Bounce">
          </div>
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Mistake (if any)</label> <input type="text" id="trade-mistake" class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white" placeholder="e.g., Entered too early, Moved SL">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Lesson Learned</label> <input type="text" id="trade-lesson" class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white" placeholder="e.g., Wait for confirmation candle">
         </div>
         <div><label class="block text-sm text-gray-400 mb-2">Additional Notes</label> <textarea id="trade-notes" rows="3" class="w-full px-4 py-3 bg-navy-800 border border-navy-600 rounded-xl text-white resize-none" placeholder="Any additional observations..."></textarea>
         </div>
        </div><!-- Submit Buttons -->
        <div class="flex gap-4"><button type="submit" id="submit-trade-btn" class="flex-1 py-4 btn-gold rounded-xl text-navy-900 font-semibold text-lg"> Save Trade </button> <button type="button" id="cancel-trade-btn" class="px-6 py-4 bg-navy-700 hover:bg-navy-600 rounded-xl text-white font-medium"> Cancel </button>
        </div>
       </form>
      </div>
     </div><!-- Analytics View -->
     <div id="view-analytics" class="hidden space-y-6">
      <div class="grid lg:grid-cols-2 gap-6"><!-- Monthly Performance -->
       <div class="glass-card rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Monthly Performance</h3>
        <div class="h-64">
         <canvas id="monthly-chart"></canvas>
        </div>
       </div><!-- RR Distribution -->
       <div class="glass-card rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">R:R Distribution</h3>
        <div class="h-64">
         <canvas id="rr-chart"></canvas>
        </div>
       </div>
      </div>
      <div class="grid lg:grid-cols-2 gap-6"><!-- Drawdown Chart -->
       <div class="glass-card rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Drawdown Analysis</h3>
        <div class="h-64">
         <canvas id="drawdown-chart"></canvas>
        </div>
       </div><!-- Pair Performance -->
       <div class="glass-card rounded-xl p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Performance by Pair</h3>
        <div id="pair-stats" class="space-y-3 max-h-64 overflow-y-auto">
         <p class="text-gray-500 text-center py-8">No data available</p>
        </div>
       </div>
      </div>
     </div><!-- History View -->
     <div id="view-history" class="hidden">
      <div class="glass-card rounded-xl p-6"><!-- Filters -->
       <div class="flex flex-wrap gap-4 mb-6">
        <div class="flex-1 min-w-[200px]"><input type="text" id="search-trades" class="w-full px-4 py-2 bg-navy-800 border border-navy-600 rounded-lg text-white placeholder-gray-500" placeholder="ðŸ” Search trades...">
        </div><select id="filter-pair" class="px-4 py-2 bg-navy-800 border border-navy-600 rounded-lg text-white"> <option value="">All Pairs</option> <option value="EURUSD">EUR/USD</option> <option value="GBPUSD">GBP/USD</option> <option value="XAUUSD">XAU/USD</option> <option value="USDJPY">USD/JPY</option> </select> <select id="filter-result" class="px-4 py-2 bg-navy-800 border border-navy-600 rounded-lg text-white"> <option value="">All Results</option> <option value="WIN">Wins</option> <option value="LOSS">Losses</option> <option value="BREAKEVEN">Break-even</option> </select> <input type="date" id="filter-date-from" class="px-4 py-2 bg-navy-800 border border-navy-600 rounded-lg text-white"> <input type="date" id="filter-date-to" class="px-4 py-2 bg-navy-800 border border-navy-600 rounded-lg text-white">
       </div><!-- Table -->
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead>
          <tr class="text-left text-gray-500 text-xs uppercase tracking-wider border-b border-navy-700">
           <th class="pb-3 pr-4">Date</th>
           <th class="pb-3 pr-4">Pair</th>
           <th class="pb-3 pr-4">Type</th>
           <th class="pb-3 pr-4">Entry</th>
           <th class="pb-3 pr-4">SL</th>
           <th class="pb-3 pr-4">TP</th>
           <th class="pb-3 pr-4">Lots</th>
           <th class="pb-3 pr-4">Risk%</th>
           <th class="pb-3 pr-4">Result</th>
           <th class="pb-3 pr-4 text-right">P/L</th>
           <th class="pb-3 pr-4">Actions</th>
          </tr>
         </thead>
         <tbody id="trade-history" class="text-sm">
          <tr class="text-gray-500">
           <td colspan="11" class="py-8 text-center">No trades found</td>
          </tr>
         </tbody>
        </table>
       </div><!-- Pagination Info -->
       <div id="pagination-info" class="mt-4 text-center text-gray-500 text-sm"></div>
      </div>
     </div>
    </main>
   </div><!-- Trade Detail Modal -->
   <div id="trade-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4" style="background: rgba(0,0,0,0.8);">
    <div class="glass-card rounded-2xl p-6 max-w-lg w-full max-h-[90%] overflow-y-auto">
     <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-bold text-white">Trade Details</h3><button id="close-modal" class="text-gray-400 hover:text-white">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div id="modal-content"></div>
     <div class="mt-6 flex gap-3"><button id="delete-trade-btn" class="flex-1 py-3 bg-red-600 hover:bg-red-700 rounded-xl text-white font-medium">Delete Trade</button> <button id="close-modal-btn" class="flex-1 py-3 bg-navy-700 hover:bg-navy-600 rounded-xl text-white font-medium">Close</button>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="hidden fixed bottom-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg animate-slide-up">
    <p id="toast-message" class="text-sm font-medium"></p>
   </div><!-- Delete Confirmation Modal -->
   <div id="delete-confirm-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4" style="background: rgba(0,0,0,0.8);">
    <div class="glass-card rounded-2xl p-6 max-w-sm w-full">
     <h3 class="text-xl font-bold text-white mb-4">Confirm Delete</h3>
     <p class="text-gray-400 mb-6">Are you sure you want to delete this trade? This action cannot be undone.</p>
     <div class="flex gap-3"><button id="confirm-delete-btn" class="flex-1 py-3 bg-red-600 hover:bg-red-700 rounded-xl text-white font-medium">Delete</button> <button id="cancel-delete-btn" class="flex-1 py-3 bg-navy-700 hover:bg-navy-600 rounded-xl text-white font-medium">Cancel</button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // App State
    let currentUser = null;
    let trades = [];
    let charts = {};
    let selectedTrade = null;
    let isLoading = false;
    
    // Default Config
    const defaultConfig = {
      app_title: 'ProForex Journal',
      tagline: 'Professional Trading Journal',
      background_color: '#0a0e1a',
      surface_color: '#0f1629',
      text_color: '#f3f4f6',
      primary_action: '#d4af37',
      secondary_action: '#6b7280'
    };
    
    let config = { ...defaultConfig };
    
    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          applyConfig();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [
            { get: () => cfg.background_color || defaultConfig.background_color, set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }},
            { get: () => cfg.surface_color || defaultConfig.surface_color, set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }},
            { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }},
            { get: () => cfg.primary_action || defaultConfig.primary_action, set: (v) => { cfg.primary_action = v; window.elementSdk.setConfig({ primary_action: v }); }},
            { get: () => cfg.secondary_action || defaultConfig.secondary_action, set: (v) => { cfg.secondary_action = v; window.elementSdk.setConfig({ secondary_action: v }); }}
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['app_title', cfg.app_title || defaultConfig.app_title],
          ['tagline', cfg.tagline || defaultConfig.tagline]
        ])
      });
    }
    
    function applyConfig() {
      document.body.style.backgroundColor = config.background_color;
      document.getElementById('auth-title').textContent = config.app_title;
      document.getElementById('auth-tagline').textContent = config.tagline;
      document.getElementById('dashboard-title').textContent = config.app_title;
    }
    
    // Data Handler
    const dataHandler = {
      onDataChanged(data) {
        if (!currentUser) return;
        trades = data.filter(t => t.userId === currentUser.id);
        updateDashboard();
        updateCharts();
        updateRecentTrades();
        updateTradeHistory();
        updateAnalytics();
      }
    };
    
    // Initialize Data SDK
    let sdkReady = false;
    async function initDataSdk() {
      // Wait a bit for SDK to be available globally
      for (let i = 0; i < 20; i++) {
        if (window.dataSdk) {
          try {
            const result = await window.dataSdk.init(dataHandler);
            if (result.isOk) {
              sdkReady = true;
              return;
            }
          } catch (err) {
            console.error('SDK init error:', err);
          }
        }
        await new Promise(r => setTimeout(r, 100));
      }
    }
    
    // Start initialization immediately
    initDataSdk();
    
    // User Management (Demo - uses localStorage for user auth simulation)
    function getUsers() {
      const users = localStorage.getItem('proforex_users');
      return users ? JSON.parse(users) : [];
    }
    
    function saveUsers(users) {
      localStorage.setItem('proforex_users', JSON.stringify(users));
    }
    
    function getCurrentSession() {
      const session = localStorage.getItem('proforex_session');
      return session ? JSON.parse(session) : null;
    }
    
    function saveSession(user) {
      localStorage.setItem('proforex_session', JSON.stringify(user));
    }
    
    function clearSession() {
      localStorage.removeItem('proforex_session');
    }
    
    // Auth Functions
    function login(email, password) {
      const users = getUsers();
      const user = users.find(u => u.email === email);
      
      if (!user) {
        // Auto-create user for demo
        const newUser = {
          id: 'user_' + Date.now(),
          email,
          name: email.split('@')[0],
          password,
          createdAt: new Date().toISOString()
        };
        users.push(newUser);
        saveUsers(users);
        saveSession(newUser);
        return newUser;
      }
      
      if (user.password !== password) {
        showToast('Incorrect password', 'error');
        return null;
      }
      
      saveSession(user);
      return user;
    }
    
    function signup(name, email, password) {
      const users = getUsers();
      if (users.find(u => u.email === email)) {
        showToast('Email already registered', 'error');
        return null;
      }
      
      const newUser = {
        id: 'user_' + Date.now(),
        email,
        name,
        password,
        createdAt: new Date().toISOString()
      };
      
      users.push(newUser);
      saveUsers(users);
      saveSession(newUser);
      return newUser;
    }
    
    function logout() {
      clearSession();
      currentUser = null;
      trades = [];
      document.getElementById('auth-screen').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
    }
    
    // UI Functions
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMsg = document.getElementById('toast-message');
      
      toastMsg.textContent = message;
      toast.className = `fixed bottom-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg animate-slide-up ${
        type === 'success' ? 'bg-profit text-white' : 
        type === 'error' ? 'bg-loss text-white' : 
        'bg-gold-500 text-navy-900'
      }`;
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }
    
    function switchView(viewName) {
      ['overview', 'journal', 'analytics', 'history'].forEach(v => {
        const el = document.getElementById(`view-${v}`);
        if (el) el.classList.toggle('hidden', v !== viewName);
      });
      
      document.querySelectorAll('.nav-item').forEach(item => {
        const isActive = item.dataset.view === viewName;
        item.classList.toggle('active', isActive);
        item.classList.toggle('text-white', isActive);
        item.classList.toggle('text-gray-400', !isActive);
      });
    }
    
    function showDashboard(user) {
      currentUser = user;
      document.getElementById('auth-screen').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      document.getElementById('user-initial').textContent = user.name.charAt(0).toUpperCase();
      document.getElementById('user-name-display').textContent = user.name;
      document.getElementById('user-email-display').textContent = user.email;
      
      initCharts();
      updateDashboard();
    }
    
    // Dashboard Calculations
    function updateDashboard() {
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
      
      const dailyTrades = trades.filter(t => t.date === today);
      const weeklyTrades = trades.filter(t => t.date >= weekAgo);
      const monthlyTrades = trades.filter(t => t.date >= monthStart);
      
      const dailyPL = dailyTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
      const weeklyPL = weeklyTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
      const monthlyPL = monthlyTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
      const totalPL = trades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
      
      document.getElementById('pl-daily').textContent = formatCurrency(dailyPL);
      document.getElementById('pl-daily').className = `text-2xl font-bold font-mono ${dailyPL >= 0 ? 'text-profit' : 'text-loss'}`;
      document.getElementById('pl-daily-trades').textContent = `${dailyTrades.length} trades`;
      
      document.getElementById('pl-weekly').textContent = formatCurrency(weeklyPL);
      document.getElementById('pl-weekly').className = `text-2xl font-bold font-mono ${weeklyPL >= 0 ? 'text-profit' : 'text-loss'}`;
      document.getElementById('pl-weekly-trades').textContent = `${weeklyTrades.length} trades`;
      
      document.getElementById('pl-monthly').textContent = formatCurrency(monthlyPL);
      document.getElementById('pl-monthly').className = `text-2xl font-bold font-mono ${monthlyPL >= 0 ? 'text-profit' : 'text-loss'}`;
      document.getElementById('pl-monthly-trades').textContent = `${monthlyTrades.length} trades`;
      
      document.getElementById('pl-total').textContent = formatCurrency(totalPL);
      document.getElementById('pl-total').className = `text-2xl font-bold font-mono ${totalPL >= 0 ? 'text-profit' : 'text-loss'}`;
      document.getElementById('pl-total-trades').textContent = `${trades.length} trades`;
      
      // Metrics
      const wins = trades.filter(t => t.result === 'WIN').length;
      const winRate = trades.length > 0 ? (wins / trades.length * 100).toFixed(1) : 0;
      document.getElementById('win-rate').textContent = `${winRate}%`;
      
      const avgRR = calculateAvgRR();
      document.getElementById('avg-rr').textContent = avgRR;
      
      const maxDD = calculateMaxDrawdown();
      document.getElementById('max-drawdown').textContent = `${maxDD.toFixed(1)}%`;
      
      document.getElementById('total-trades').textContent = trades.length;
      
      const avgRisk = trades.length > 0 
        ? (trades.reduce((sum, t) => sum + (t.riskPercent || 0), 0) / trades.length).toFixed(1) 
        : 0;
      document.getElementById('avg-risk').textContent = `${avgRisk}%`;
      
      const avgRMult = calculateAvgRMultiple();
      document.getElementById('avg-r-multiple').textContent = `${avgRMult}R`;
    }
    
    function formatCurrency(amount) {
      const prefix = amount >= 0 ? '+$' : '-$';
      return prefix + Math.abs(amount).toFixed(2);
    }
    
    function calculateAvgRR() {
      if (trades.length === 0) return '0:0';
      
      let totalRR = 0;
      let validTrades = 0;
      
      trades.forEach(t => {
        if (t.entryPrice && t.stopLoss && t.takeProfit) {
          const risk = Math.abs(t.entryPrice - t.stopLoss);
          const reward = Math.abs(t.takeProfit - t.entryPrice);
          if (risk > 0) {
            totalRR += reward / risk;
            validTrades++;
          }
        }
      });
      
      if (validTrades === 0) return '0:0';
      const avgRR = totalRR / validTrades;
      return `1:${avgRR.toFixed(1)}`;
    }
    
    function calculateMaxDrawdown() {
      if (trades.length === 0) return 0;
      
      let peak = 0;
      let balance = 0;
      let maxDD = 0;
      
      const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
      
      sortedTrades.forEach(t => {
        balance += t.profitLoss || 0;
        if (balance > peak) peak = balance;
        const dd = peak > 0 ? ((peak - balance) / peak) * 100 : 0;
        if (dd > maxDD) maxDD = dd;
      });
      
      return maxDD;
    }
    
    function calculateAvgRMultiple() {
      if (trades.length === 0) return '0.0';
      
      let totalR = 0;
      let validTrades = 0;
      
      trades.forEach(t => {
        if (t.riskPercent && t.profitLoss) {
          const rMult = t.profitLoss / (t.riskPercent * 100);
          totalR += rMult;
          validTrades++;
        }
      });
      
      if (validTrades === 0) return '0.0';
      return (totalR / validTrades).toFixed(2);
    }
    
    // Charts
    function initCharts() {
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#9ca3af' }
          }
        },
        scales: {
          x: {
            grid: { color: 'rgba(107, 114, 128, 0.1)' },
            ticks: { color: '#9ca3af' }
          },
          y: {
            grid: { color: 'rgba(107, 114, 128, 0.1)' },
            ticks: { color: '#9ca3af' }
          }
        }
      };
      
      // Equity Chart
      const equityCtx = document.getElementById('equity-chart').getContext('2d');
      charts.equity = new Chart(equityCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Equity',
            data: [],
            borderColor: '#d4af37',
            backgroundColor: 'rgba(212, 175, 55, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: chartOptions
      });
      
      // Win/Loss Chart
      const winlossCtx = document.getElementById('winloss-chart').getContext('2d');
      charts.winloss = new Chart(winlossCtx, {
        type: 'doughnut',
        data: {
          labels: ['Wins', 'Losses', 'Break-even'],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: ['#10b981', '#ef4444', '#6b7280'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: '#9ca3af', padding: 20 }
            }
          }
        }
      });
      
      // Monthly Chart
      const monthlyCtx = document.getElementById('monthly-chart').getContext('2d');
      charts.monthly = new Chart(monthlyCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'P/L',
            data: [],
            backgroundColor: (ctx) => ctx.raw >= 0 ? '#10b981' : '#ef4444'
          }]
        },
        options: chartOptions
      });
      
      // RR Chart
      const rrCtx = document.getElementById('rr-chart').getContext('2d');
      charts.rr = new Chart(rrCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Trades',
            data: [],
            backgroundColor: '#d4af37'
          }]
        },
        options: chartOptions
      });
      
      // Drawdown Chart
      const ddCtx = document.getElementById('drawdown-chart').getContext('2d');
      charts.drawdown = new Chart(ddCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Drawdown %',
            data: [],
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: chartOptions
      });
    }
    
    function updateCharts() {
      if (!charts.equity) return;
      
      // Equity Curve
      const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
      let balance = 0;
      const equityData = sortedTrades.map(t => {
        balance += t.profitLoss || 0;
        return balance;
      });
      
      charts.equity.data.labels = sortedTrades.map(t => t.date);
      charts.equity.data.datasets[0].data = equityData;
      charts.equity.update();
      
      // Win/Loss
      const wins = trades.filter(t => t.result === 'WIN').length;
      const losses = trades.filter(t => t.result === 'LOSS').length;
      const be = trades.filter(t => t.result === 'BREAKEVEN').length;
      charts.winloss.data.datasets[0].data = [wins, losses, be];
      charts.winloss.update();
    }
    
    function updateAnalytics() {
      if (!charts.monthly) return;
      
      // Monthly Performance
      const monthlyData = {};
      trades.forEach(t => {
        const month = t.date.substring(0, 7);
        monthlyData[month] = (monthlyData[month] || 0) + (t.profitLoss || 0);
      });
      
      const months = Object.keys(monthlyData).sort();
      charts.monthly.data.labels = months;
      charts.monthly.data.datasets[0].data = months.map(m => monthlyData[m]);
      charts.monthly.update();
      
      // RR Distribution
      const rrRanges = { '< 1:1': 0, '1:1 - 1:2': 0, '1:2 - 1:3': 0, '> 1:3': 0 };
      trades.forEach(t => {
        if (t.entryPrice && t.stopLoss && t.takeProfit) {
          const risk = Math.abs(t.entryPrice - t.stopLoss);
          const reward = Math.abs(t.takeProfit - t.entryPrice);
          const rr = risk > 0 ? reward / risk : 0;
          
          if (rr < 1) rrRanges['< 1:1']++;
          else if (rr < 2) rrRanges['1:1 - 1:2']++;
          else if (rr < 3) rrRanges['1:2 - 1:3']++;
          else rrRanges['> 1:3']++;
        }
      });
      
      charts.rr.data.labels = Object.keys(rrRanges);
      charts.rr.data.datasets[0].data = Object.values(rrRanges);
      charts.rr.update();
      
      // Drawdown
      const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
      let peak = 0, balance = 0;
      const ddData = sortedTrades.map(t => {
        balance += t.profitLoss || 0;
        if (balance > peak) peak = balance;
        return peak > 0 ? ((peak - balance) / peak) * 100 : 0;
      });
      
      charts.drawdown.data.labels = sortedTrades.map(t => t.date);
      charts.drawdown.data.datasets[0].data = ddData;
      charts.drawdown.update();
      
      // Pair Stats
      const pairStats = {};
      trades.forEach(t => {
        if (!pairStats[t.pair]) {
          pairStats[t.pair] = { trades: 0, pnl: 0, wins: 0 };
        }
        pairStats[t.pair].trades++;
        pairStats[t.pair].pnl += t.profitLoss || 0;
        if (t.result === 'WIN') pairStats[t.pair].wins++;
      });
      
      const pairStatsEl = document.getElementById('pair-stats');
      if (Object.keys(pairStats).length === 0) {
        pairStatsEl.innerHTML = '<p class="text-gray-500 text-center py-8">No data available</p>';
      } else {
        pairStatsEl.innerHTML = Object.entries(pairStats)
          .sort((a, b) => b[1].pnl - a[1].pnl)
          .map(([pair, stats]) => `
            <div class="flex items-center justify-between p-3 bg-navy-800/50 rounded-lg">
              <div>
                <p class="text-white font-medium">${pair}</p>
                <p class="text-xs text-gray-500">${stats.trades} trades Â· ${(stats.wins / stats.trades * 100).toFixed(0)}% WR</p>
              </div>
              <p class="font-mono font-bold ${stats.pnl >= 0 ? 'text-profit' : 'text-loss'}">${formatCurrency(stats.pnl)}</p>
            </div>
          `).join('');
      }
    }
    
    function updateRecentTrades() {
      const tbody = document.getElementById('recent-trades');
      const recent = [...trades].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
      
      if (recent.length === 0) {
        tbody.innerHTML = '<tr class="text-gray-500"><td colspan="6" class="py-8 text-center">No trades yet. Add your first trade to get started!</td></tr>';
        return;
      }
      
      tbody.innerHTML = recent.map(t => `
        <tr class="table-row border-b border-navy-700/50 cursor-pointer" onclick="showTradeModal('${t.__backendId}')">
          <td class="py-3 pr-4 text-gray-400">${t.date}</td>
          <td class="py-3 pr-4 text-white font-medium">${t.pair}</td>
          <td class="py-3 pr-4">
            <span class="px-2 py-1 rounded text-xs font-medium ${t.type === 'BUY' ? 'bg-profit/20 text-profit' : 'bg-loss/20 text-loss'}">${t.type}</span>
          </td>
          <td class="py-3 pr-4 font-mono text-gray-400">${t.entryPrice}</td>
          <td class="py-3 pr-4">
            <span class="px-2 py-1 rounded text-xs font-medium ${
              t.result === 'WIN' ? 'bg-profit/20 text-profit' : 
              t.result === 'LOSS' ? 'bg-loss/20 text-loss' : 
              'bg-gray-500/20 text-gray-400'
            }">${t.result}</span>
          </td>
          <td class="py-3 text-right font-mono font-medium ${t.profitLoss >= 0 ? 'text-profit' : 'text-loss'}">${formatCurrency(t.profitLoss)}</td>
        </tr>
      `).join('');
    }
    
    function updateTradeHistory() {
      const tbody = document.getElementById('trade-history');
      const search = document.getElementById('search-trades').value.toLowerCase();
      const filterPair = document.getElementById('filter-pair').value;
      const filterResult = document.getElementById('filter-result').value;
      const filterFrom = document.getElementById('filter-date-from').value;
      const filterTo = document.getElementById('filter-date-to').value;
      
      let filtered = [...trades];
      
      if (search) {
        filtered = filtered.filter(t => 
          t.pair.toLowerCase().includes(search) || 
          t.notes?.toLowerCase().includes(search) ||
          t.setup?.toLowerCase().includes(search)
        );
      }
      if (filterPair) filtered = filtered.filter(t => t.pair === filterPair);
      if (filterResult) filtered = filtered.filter(t => t.result === filterResult);
      if (filterFrom) filtered = filtered.filter(t => t.date >= filterFrom);
      if (filterTo) filtered = filtered.filter(t => t.date <= filterTo);
      
      filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr class="text-gray-500"><td colspan="11" class="py-8 text-center">No trades found</td></tr>';
        document.getElementById('pagination-info').textContent = '';
        return;
      }
      
      tbody.innerHTML = filtered.map(t => `
        <tr class="table-row border-b border-navy-700/50">
          <td class="py-3 pr-4 text-gray-400">${t.date}</td>
          <td class="py-3 pr-4 text-white font-medium">${t.pair}</td>
          <td class="py-3 pr-4">
            <span class="px-2 py-1 rounded text-xs font-medium ${t.type === 'BUY' ? 'bg-profit/20 text-profit' : 'bg-loss/20 text-loss'}">${t.type}</span>
          </td>
          <td class="py-3 pr-4 font-mono text-gray-400 text-xs">${t.entryPrice}</td>
          <td class="py-3 pr-4 font-mono text-gray-400 text-xs">${t.stopLoss}</td>
          <td class="py-3 pr-4 font-mono text-gray-400 text-xs">${t.takeProfit}</td>
          <td class="py-3 pr-4 font-mono text-gray-400">${t.lotSize}</td>
          <td class="py-3 pr-4 font-mono text-gray-400">${t.riskPercent}%</td>
          <td class="py-3 pr-4">
            <span class="px-2 py-1 rounded text-xs font-medium ${
              t.result === 'WIN' ? 'bg-profit/20 text-profit' : 
              t.result === 'LOSS' ? 'bg-loss/20 text-loss' : 
              'bg-gray-500/20 text-gray-400'
            }">${t.result}</span>
          </td>
          <td class="py-3 pr-4 text-right font-mono font-medium ${t.profitLoss >= 0 ? 'text-profit' : 'text-loss'}">${formatCurrency(t.profitLoss)}</td>
          <td class="py-3">
            <button onclick="showTradeModal('${t.__backendId}')" class="text-gold-500 hover:text-gold-400">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
            </button>
          </td>
        </tr>
      `).join('');
      
      document.getElementById('pagination-info').textContent = `Showing ${filtered.length} of ${trades.length} trades`;
    }
    
    function showTradeModal(tradeId) {
      selectedTrade = trades.find(t => t.__backendId === tradeId);
      if (!selectedTrade) return;
      
      const modal = document.getElementById('trade-modal');
      const content = document.getElementById('modal-content');
      
      const rr = selectedTrade.entryPrice && selectedTrade.stopLoss && selectedTrade.takeProfit
        ? (Math.abs(selectedTrade.takeProfit - selectedTrade.entryPrice) / Math.abs(selectedTrade.entryPrice - selectedTrade.stopLoss)).toFixed(2)
        : '-';
      
      content.innerHTML = `
        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-2xl font-bold text-white">${selectedTrade.pair}</p>
              <p class="text-gray-500">${selectedTrade.date}</p>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold font-mono ${selectedTrade.profitLoss >= 0 ? 'text-profit' : 'text-loss'}">${formatCurrency(selectedTrade.profitLoss)}</p>
              <span class="px-3 py-1 rounded text-sm font-medium ${
                selectedTrade.result === 'WIN' ? 'bg-profit/20 text-profit' : 
                selectedTrade.result === 'LOSS' ? 'bg-loss/20 text-loss' : 
                'bg-gray-500/20 text-gray-400'
              }">${selectedTrade.result}</span>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-4 py-4 border-t border-b border-navy-700">
            <div>
              <p class="text-xs text-gray-500">Type</p>
              <p class="font-medium ${selectedTrade.type === 'BUY' ? 'text-profit' : 'text-loss'}">${selectedTrade.type}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Lot Size</p>
              <p class="font-mono text-white">${selectedTrade.lotSize}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Entry</p>
              <p class="font-mono text-white">${selectedTrade.entryPrice}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">R:R</p>
              <p class="font-mono text-gold-500">1:${rr}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Stop Loss</p>
              <p class="font-mono text-loss">${selectedTrade.stopLoss}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Take Profit</p>
              <p class="font-mono text-profit">${selectedTrade.takeProfit}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Risk %</p>
              <p class="font-mono text-white">${selectedTrade.riskPercent}%</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Emotion</p>
              <p class="text-white">${selectedTrade.emotion || '-'}</p>
            </div>
          </div>
          
          ${selectedTrade.setup ? `<div><p class="text-xs text-gray-500 mb-1">Setup</p><p class="text-white">${selectedTrade.setup}</p></div>` : ''}
          ${selectedTrade.mistake ? `<div><p class="text-xs text-gray-500 mb-1">Mistake</p><p class="text-loss">${selectedTrade.mistake}</p></div>` : ''}
          ${selectedTrade.lesson ? `<div><p class="text-xs text-gray-500 mb-1">Lesson</p><p class="text-profit">${selectedTrade.lesson}</p></div>` : ''}
          ${selectedTrade.notes ? `<div><p class="text-xs text-gray-500 mb-1">Notes</p><p class="text-gray-300">${selectedTrade.notes}</p></div>` : ''}
        </div>
      `;
      
      modal.classList.remove('hidden');
    }
    
    // Calculate RR
    function calculateRR() {
      const entry = parseFloat(document.getElementById('trade-entry').value);
      const sl = parseFloat(document.getElementById('trade-sl').value);
      const tp = parseFloat(document.getElementById('trade-tp').value);
      
      if (!entry || !sl || !tp) {
        document.getElementById('calculated-rr').textContent = '-';
        return;
      }
      
      const risk = Math.abs(entry - sl);
      const reward = Math.abs(tp - entry);
      
      if (risk === 0) {
        document.getElementById('calculated-rr').textContent = '-';
        return;
      }
      
      const rr = (reward / risk).toFixed(2);
      document.getElementById('calculated-rr').textContent = `1:${rr}`;
    }
    
    // Export CSV
    function exportCSV() {
      if (trades.length === 0) {
        showToast('No trades to export', 'error');
        return;
      }
      
      const headers = ['Date', 'Pair', 'Type', 'Entry', 'Stop Loss', 'Take Profit', 'Lot Size', 'Risk %', 'Result', 'P/L', 'Emotion', 'Setup', 'Mistake', 'Lesson', 'Notes'];
      const rows = trades.map(t => [
        t.date, t.pair, t.type, t.entryPrice, t.stopLoss, t.takeProfit, t.lotSize, t.riskPercent, t.result, t.profitLoss, t.emotion || '', t.setup || '', t.mistake || '', t.lesson || '', t.notes || ''
      ]);
      
      const csv = [headers.join(','), ...rows.map(r => r.map(c => `"${c}"`).join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `proforex_journal_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('Journal exported successfully!');
    }
    
    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Check existing session
      const session = getCurrentSession();
      if (session) {
        showDashboard(session);
      }
      
      // Set today's date
      document.getElementById('trade-date').valueAsDate = new Date();
      
      // Auth form switching
      document.getElementById('show-signup').addEventListener('click', () => {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('signup-form').classList.remove('hidden');
      });
      
      document.getElementById('show-login').addEventListener('click', () => {
        document.getElementById('signup-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
      });
      
      document.getElementById('show-forgot').addEventListener('click', () => {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('forgot-form').classList.remove('hidden');
      });
      
      document.getElementById('show-login-2').addEventListener('click', () => {
        document.getElementById('forgot-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
      });
      
      // Login
      document.getElementById('login-submit').addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        const user = login(email, password);
        if (user) {
          showToast('Welcome back!');
          showDashboard(user);
        }
      });
      
      // Signup
      document.getElementById('signup-submit').addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('signup-name').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const user = signup(name, email, password);
        if (user) {
          showToast('Account created!');
          showDashboard(user);
        }
      });
      
      // Forgot password
      document.getElementById('forgot-submit').addEventListener('submit', (e) => {
        e.preventDefault();
        showToast('Reset link sent! (Demo)', 'info');
        document.getElementById('forgot-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
      });
      
      // Navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          switchView(item.dataset.view);
        });
      });
      
      // Add trade button
      document.getElementById('add-trade-btn').addEventListener('click', () => {
        switchView('journal');
      });
      
      // User menu
      document.getElementById('user-menu-btn').addEventListener('click', () => {
        document.getElementById('user-dropdown').classList.toggle('hidden');
      });
      
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#user-menu-btn') && !e.target.closest('#user-dropdown')) {
          document.getElementById('user-dropdown').classList.add('hidden');
        }
      });
      
      // Logout
      document.getElementById('logout-btn').addEventListener('click', logout);
      
      // Export
      document.getElementById('export-csv').addEventListener('click', exportCSV);
      
      // Trade form
      document.getElementById('trade-entry').addEventListener('input', calculateRR);
      document.getElementById('trade-sl').addEventListener('input', calculateRR);
      document.getElementById('trade-tp').addEventListener('input', calculateRR);
      
      document.getElementById('trade-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (isLoading) return;
        
        // Wait for SDK to be ready
        if (!window.dataSdk || !sdkReady) {
          showToast('Data storage not ready. Please try again.', 'error');
          return;
        }
        
        if (trades.length >= 999) {
          showToast('Maximum trade limit reached (999)', 'error');
          return;
        }
        
        isLoading = true;
        const btn = document.getElementById('submit-trade-btn');
        btn.textContent = 'Saving...';
        btn.disabled = true;
        
        const trade = {
          userId: currentUser.id,
          date: document.getElementById('trade-date').value,
          pair: document.getElementById('trade-pair').value,
          type: document.getElementById('trade-type').value,
          entryPrice: parseFloat(document.getElementById('trade-entry').value),
          stopLoss: parseFloat(document.getElementById('trade-sl').value),
          takeProfit: parseFloat(document.getElementById('trade-tp').value),
          lotSize: parseFloat(document.getElementById('trade-lots').value),
          riskPercent: parseFloat(document.getElementById('trade-risk').value),
          result: document.getElementById('trade-result').value,
          profitLoss: parseFloat(document.getElementById('trade-pnl').value),
          emotion: document.getElementById('trade-emotion').value,
          setup: document.getElementById('trade-setup').value,
          mistake: document.getElementById('trade-mistake').value,
          lesson: document.getElementById('trade-lesson').value,
          notes: document.getElementById('trade-notes').value,
          createdAt: new Date().toISOString()
        };
        
        try {
          const result = await window.dataSdk.create(trade);
          if (result.isOk) {
            showToast('Trade saved successfully!');
            document.getElementById('trade-form').reset();
            document.getElementById('trade-date').valueAsDate = new Date();
            document.getElementById('calculated-rr').textContent = '-';
            switchView('overview');
          } else {
            showToast('Failed to save trade', 'error');
            console.error('Create error:', result.error);
          }
        } catch (err) {
          showToast('Error saving trade', 'error');
          console.error('Submit error:', err);
        }
        
        isLoading = false;
        btn.textContent = 'Save Trade';
        btn.disabled = false;
      });
      
      document.getElementById('cancel-trade-btn').addEventListener('click', () => {
        document.getElementById('trade-form').reset();
        document.getElementById('trade-date').valueAsDate = new Date();
        document.getElementById('calculated-rr').textContent = '-';
        switchView('overview');
      });
      
      // Modal
      document.getElementById('close-modal').addEventListener('click', () => {
        document.getElementById('trade-modal').classList.add('hidden');
        selectedTrade = null;
      });
      
      document.getElementById('close-modal-btn').addEventListener('click', () => {
        document.getElementById('trade-modal').classList.add('hidden');
        selectedTrade = null;
      });
      
      document.getElementById('delete-trade-btn').addEventListener('click', () => {
        document.getElementById('trade-modal').classList.add('hidden');
        document.getElementById('delete-confirm-modal').classList.remove('hidden');
      });
      
      document.getElementById('cancel-delete-btn').addEventListener('click', () => {
        document.getElementById('delete-confirm-modal').classList.add('hidden');
      });
      
      document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
        if (!selectedTrade || isLoading) return;
        
        isLoading = true;
        const btn = document.getElementById('confirm-delete-btn');
        btn.textContent = 'Deleting...';
        btn.disabled = true;
        
        if (window.dataSdk) {
          const result = await window.dataSdk.delete(selectedTrade);
          if (result.isOk) {
            showToast('Trade deleted');
          } else {
            showToast('Failed to delete trade', 'error');
          }
        }
        
        isLoading = false;
        btn.textContent = 'Delete';
        btn.disabled = false;
        document.getElementById('delete-confirm-modal').classList.add('hidden');
        selectedTrade = null;
      });
      
      // Filters
      document.getElementById('search-trades').addEventListener('input', updateTradeHistory);
      document.getElementById('filter-pair').addEventListener('change', updateTradeHistory);
      document.getElementById('filter-result').addEventListener('change', updateTradeHistory);
      document.getElementById('filter-date-from').addEventListener('change', updateTradeHistory);
      document.getElementById('filter-date-to').addEventListener('change', updateTradeHistory);
      
      // Apply config
      applyConfig();
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d4c09a7f7d0b2d8',t:'MTc3MjI0MDk3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>